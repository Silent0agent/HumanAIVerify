{% extends "base.html" %}
{% load thumbnail %}
{% load i18n %}
{% load static %}

{% block content %}
  {% include "includes/tasks_header.html" %}

  <div class="container-fluid mb-5">

    <ul class="nav nav-tabs nav-fill mb-4" id="taskTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active fw-bold"
                id="available-tab"
                data-bs-toggle="tab"
                data-bs-target="#available-pane"
                type="button"
                role="tab"
                aria-controls="available-pane"
                aria-selected="true">
          <i class="bi bi-inbox me-2"></i>{% translate "available_tasks" %}
          {% if available_tasks %}<span class="badge bg-primary rounded-pill ms-2">{{ available_tasks.count }}</span>{% endif %}
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link fw-bold"
                id="completed-tab"
                data-bs-toggle="tab"
                data-bs-target="#completed-pane"
                type="button"
                role="tab"
                aria-controls="completed-pane"
                aria-selected="false">
          <i class="bi bi-check2-circle me-2"></i>{% translate "completed_tasks" %}
        </button>
      </li>
    </ul>

    <div class="tab-content" id="taskTabsContent">

      <div class="tab-pane fade show active" id="available-pane" role="tabpanel" aria-labelledby="available-tab" tabindex="0">
        {% if available_tasks %}
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            {% for task in available_tasks %}
              <div class="col">
                <div class="card h-100 shadow-sm border-0 hover-lift">
                  <div class="card-header bg-transparent d-flex justify-content-between align-items-center text-muted small border-bottom-0 pt-3">
                    <span title="{% translate 'Client' %}">
                      <i class="bi bi-person-circle me-1"></i>{{ task.client.username }}
                    </span>
                    <span>{{ task.created_at|date:"d.m.Y" }}</span>
                  </div>

                  <div class="card-body">
                    <h5 class="card-title text-truncate" title="{{ task.title }}">{{ task.title }}</h5>

                    <div class="bg-light rounded p-2 mt-3 d-flex align-items-center justify-content-center text-secondary" style="height: 120px; overflow: hidden;">
                      {% block task_content %}
                        <small class="text-muted">{% translate "No preview" %}</small>
                      {% endblock task_content %}
                    </div>
                  </div>

                  <div class="card-footer bg-transparent border-top-0 pb-3">
                    <div class="d-grid">
                      {% block available_task_title %}
                        <a href="{{ task.get_absolute_url }}" class="btn btn-outline-primary">{% translate "View Task" %}</a>
                      {% endblock available_task_title %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-5 text-muted">
            <i class="bi bi-emoji-smile display-1 mb-3"></i>
            <h4>
              {% block no_tasks %}
                {% translate "No tasks available" %}
              {% endblock no_tasks %}
            </h4>
            <p>{% translate "Good job! You've cleared the queue." %}</p>
          </div>
        {% endif %}
      </div>

      <div class="tab-pane fade" id="completed-pane" role="tabpanel" aria-labelledby="completed-tab" tabindex="0">
        {% if checks %}
          <div class="card shadow-sm border-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="ps-4">ID</th>
                    <th>{% translate "Title" %}</th>
                    <th>{% translate "Client" %}</th>
                    <th class="d-none d-md-table-cell">{% translate "Date" %}</th>
                    <th>{% translate "Status" %}</th>
                    <th class="pe-4 text-end">AI Score</th>
                  </tr>
                </thead>
                <tbody>
                  {% for check in checks %}
                    <tr>
                      <td class="ps-4 text-muted small">#{{ check.id }}</td>
                      <td>
                        <div class="fw-medium text-truncate" style="max-width: 200px;">
                          {% block completed_task_title %}<a href="{{ check.get_absolute_url }}" class="text-decoration-none text-dark">{{ check.task.title }}</a>{% endblock %}
                        </div>
                      </td>
                      <td class="small">{{ check.task.client.username }}</td>
                      <td class="text-muted small d-none d-md-table-cell">{{ check.updated_at|date:"d.m.Y" }}</td>
                      <td>
                        {% if check.status == 'published' %}
                          <span class="badge bg-success bg-opacity-10 text-success border border-success">{{ check.get_status_display }}</span>
                        {% else %}
                          <span class="badge bg-secondary bg-opacity-10 text-secondary border">{{ check.get_status_display }}</span>
                        {% endif %}
                      </td>
                      <td class="pe-4 text-end">
                        {% if check.ai_score is not None %}
                          <span class="fw-bold {% if check.ai_score > 70 %}text-success{% elif check.ai_score < 40 %}text-danger{% else %}text-warning{% endif %}">
                            {{ check.ai_score|floatformat:0 }}%
                          </span>
                        {% else %}
                          <span class="text-muted">-</span>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% else %}
          <div class="text-center py-5 text-muted">
            <i class="bi bi-journal-x display-1 mb-3"></i>
            <h4>
              {% block no_checks %}
                {% translate "No history yet" %}
              {% endblock no_checks %}
            </h4>
          </div>
        {% endif %}
      </div>

    </div>
  </div>

  <style>
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hover-lift:hover {
      transform: translateY(-3px);
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1)!important;
    }
    .nav-tabs .nav-link {
      color: #6c757d;
      border: none;
      border-bottom: 3px solid transparent;
    }
    .nav-tabs .nav-link:hover {
      border-color: transparent;
      color: #0d6efd;
    }
    .nav-tabs .nav-link.active {
      color: #0d6efd;
      border-bottom: 3px solid #0d6efd;
      background: transparent;
    }
  </style>

{% endblock content %}

{% comment %} {% extends "base.html" %}
{% load thumbnail %}
{% load i18n %}
{% load static %}

{% block content %}
  {% include "includes/tasks_header.html" %}
  <h2 class="text-center">{% translate "available_tasks" %}</h2>
  {% if available_tasks %}
    <table class="table table-hover">
      <thead>
        <tr>
          <th class="fw-medium">#</th>
          <th class="fw-medium">{% translate "Title" %}</th>
          <th class="fw-medium">{% translate "Client" %}</th>
          <th class="fw-medium">{% translate "Content" %}</th>
          <th class="fw-medium">{% translate "created_at" %}</th>
          <th class="fw-medium">{% translate "Action" %}</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for task in available_tasks %}
          <tr>
            <td class="align-middle">
              <span>{{ forloop.counter }}</span>
            </td>
            <td class="align-middle">
              <span>{{ task.title }}</span>
            </td>
            <td class="align-middle">
              <span>{{ task.client.username }}</span>
            </td>
            <td class="align-middle">
              {% block task_content %}{% endblock task_content %}
            </td>
            <td class="align-middle">{{ task.created_at|date:"d.m.Y" }}</td>
            <td class="align-middle">
              {% block available_task_title %}{% endblock available_task_title %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-center">{% block no_tasks %}{% endblock no_tasks %}</p>
  {% endif %}

  <h2 class="text-center">{% translate "completed_tasks" %}</h2>
  {% if checks %}
    <table class="table table-hover">
      <thead>
        <tr>
          <th class="fw-medium">#</th>
          <th class="fw-medium">{% translate "Title" %}</th>
          <th class="fw-medium">{% translate "Client" %}</th>
          <th class="fw-medium">{% translate "Content" %}</th>
          <th class="fw-medium">{% translate "updated_at" %}</th>
          <th class="fw-medium">{% translate "Status" %}</th>
          <th class="fw-medium">{% translate "AI_score" %}</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for check in checks %}
          <tr>
            <td class="align-middle">
              <span>{{ forloop.counter }}</span>
            </td>
            <td class="align-middle">
              {% block completed_task_title %}{% endblock completed_task_title %}
            </td>
            <td class="align-middle">{{ check.task.client.username }}</td>
            <td class="align-middle">
              {% block completed_task_content %}{% endblock completed_task_content %}
            </td>
            <td class="align-middle">{{ check.task.updated_at|date:"d.m.Y" }}</td>
            <td>{{ check.get_status_display }}</td>
            <td class="align-middle">{{ check.task.ai_score|default:"?" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-center">{% block no_checks %}{% endblock no_checks %}</p>
  {% endif %}
{% endblock content %} {% endcomment %}
